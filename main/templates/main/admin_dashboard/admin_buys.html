{% extends 'main/admin_dashboard/admin_base.html' %}
{% load static %}
{% block title %}Закупки{% endblock %}
{% block body %}
<section class="menu-management">
    <h2 class="dinner">Запросы на закупку</h2>
    <!-- Счётчики за последнюю неделю -->
    <div class="status-counters mb-3 card border-left-warning h-100 shadow-sm">
        <span class="status-badge bg-warning text-dark">В рассмотрении: {{ pending_count }}</span>
    </div>
    <div class="status-counters mb-3 card border-left-danger h-100 shadow-sm">
        <span class="status-badge bg-danger text-white">Отклонено: {{ rejected_count }}</span>
    </div>
    <div class="status-counters mb-3 card border-left-success h-100 shadow-sm">
        <span class="status-badge bg-success text-white">Принято: {{ approved_count }}</span>
    </div>
    {% if buys %}
    <div class="dishes-list">
        {% for card_buys in buys %}
        <div class="dish-item" data-meal-type="{{ card_buys.get_meal_type_display }}">
            <div class="dish-header">
                <div>
                    <h3>{{ card_buys.title }}</h3>
                    <span
                        class="badge {% if card_buys.status == 'approved' %}bg-success {% elif card_buys.status == 'rejected' %}bg-danger {% else %}bg-warning text-dark{% endif %}">
                    {{ card_buys.get_status_display }}
                    </span>
                </div>
                <span class="dish-price">ID: {{ card_buys.id }}</span>
                <span class="dish-time">Создана в: {{ card_buys.created_at|date:"d.m.Y H:i" }}</span>
            </div>
            <p class="dish-desc">{{ card_buys.description|default:"Без описания" }}</p>
            <div class="dish-actions">
                {% if card_buys.status == 'pending' %}
                <form method="post" style="display: inline">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="approve" />
                    <input type="hidden" name="buy_id" value="{{ card_buys.id }}" />
                    <button type="submit" class="btn btn-success btn-sm">Принять</button>
                </form>
                <form method="post" style="display: inline">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="reject" />
                    <input type="hidden" name="buy_id" value="{{ card_buys.id }}" />
                    <button type="submit" class="btn btn-danger btn-sm">Отклонить</button>
                </form>
                {% endif %}
                <form
                    method="post"
                    onsubmit="return confirm('Удалить блюдо «{{ card_buys.title }}»?');" style="display: inline">
                    {% csrf_token %}
                    <input type="hidden" name="delete" value="1" />
                    <input type="hidden" name="card_id_buys" value="{{ card_buys.id }}" />
                    <button type="submit" class="btn-danger btn-sm">Удалить</button>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p style="color: #666; font-style: italic">Пока запросов на покупку нет.</p>
    {% endif %}
</section>
{% endblock %}