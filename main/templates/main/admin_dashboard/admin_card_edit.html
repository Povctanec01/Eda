{% extends 'main/admin_dashboard/admin_base.html' %}
{% load static %}
{% block title %}Добавить / Удалить карточки{%endblock %}
{% block body %}
    {% if messages %}
<div class="messages">
    {% for message in messages %}
        {% if message.tags == 'error' %}
            <div class="alert alert-error">{{ message }}</div>
        {% else %}
            <div class="alert alert-success">{{ message }}</div>
        {% endif %}
    {% endfor %}
</div>
{% endif %}

<!-- Форма добавления -->
<section class="menu-management">
    <h2><i class="fas fa-plus-circle"></i> Добавить новый запрос</h2>
    <form method="post" class="preferences-form">
        {% csrf_token %}
        <input type="hidden" name="add" value="1" />
        <div class="form-group">
            <label for="{{ form.title.id_for_label }}">Название блюда:</label>
            {{ form.title }}
        </div>
        <div class="form-group">
            <label for="{{ form.description.id_for_label }}">Описание:</label>
            {{ form.description }}
        </div>
        <div class="form-group">
            <label for="{{ form.meal_type.id_for_label }}">Тип приёма пищи:</label>
            {{ form.meal_type }}
        </div>
        <button type="submit" class="btn-success">Добавить запрос</button>
    </form>
</section>

<section class="menu-management" style="margin-top: 30px">
    <h2 class="dinner">Блюда</h2>

    {% if cards %}
        <div class="dishes-filters">
            <button class="btn btn-primary rounded-pill px-3" type="button" onclick="showMeals('Все')">
                <i class="fas fa-spoon"></i>
                Все
            </button>
            <button class="btn btn-primary rounded-pill px-3" type="button" onclick="showMeals('Обед')">
                <i class="fas fa-plate-wheat"></i>
                Обеды
            </button>
            <button class="btn btn-primary rounded-pill px-3" type="button" onclick="showMeals('Завтрак')">
                <i class="fas fa-mug-saucer"></i>
                Завтраки
            </button>
        </div>

        <div class="dishes-list">
            {% for card in cards %}
                <div class="dish-item" data-meal-type="{{ card.get_meal_type_display }}">
                    <div class="dish-header">
                        <div>
                            <h3>{{ card.title }}</h3>
                            <span class="badge" style="background: #667eea; color: white">{{ card.get_meal_type_display }}</span>
                        </div>
                        <span class="dish-price">ID: {{ card.id }}</span>
                    </div>
                    <p class="dish-desc">{{ card.description|default:"Без описания" }}</p>
                    <div class="dish-actions">
                        <form method="post" onsubmit="return confirm('Удалить блюдо «{{ card.title }}»?');" style="display: inline">
                            {% csrf_token %}
                            <input type="hidden" name="delete" value="1" />
                            <input type="hidden" name="card_id" value="{{ card.id }}" />
                            <button type="submit" class="btn-danger btn-sm">Удалить</button>
                        </form>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p style="color: #666; font-style: italic">Нет запросов</p>
    {% endif %}
</section>
{% endblock %}
