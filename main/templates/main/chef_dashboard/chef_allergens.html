{% extends 'main/chef_dashboard/chef_base.html' %}
{% load static %}
{% block title %}Управление аллергенами{% endblock %}
{% block body %}
<div class="allergens-container">
    <h2><i class="fas fa-allergies"></i> Управление аллергенами</h2>
    {% if messages %}
    <div class="messages">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}
    <!-- Форма добавления -->
    <section class="menu-management">
        <h3><i class="fas fa-plus-circle"></i> Добавить новый аллерген</h3>
        <form method="post" class="preferences-form">
            {% csrf_token %}
            <input type="hidden" name="add" value="1">
            <div class="form-group">
                <label for="{{ form.name.id_for_label }}">Название:</label>
                {{ form.name }}
            </div>
            <button type="submit" class="btn-success">Добавить</button>
        </form>
    </section>
    <!-- Поиск -->
    <section class="menu-management" style="margin-top: 30px;">
        <h3><i class="fas fa-search"></i> Поиск аллергенов</h3>
        <form method="get" class="search-form">
            <div class="form-group search-group">
                <input type="text"
                    name="q"
                    value="{{ query }}"
                    placeholder="Введите название аллергена для поиска..."
                    class="form-control search-input"
                    autocomplete="off">
                <button type="submit" class="btn btn-primary search-btn">
                <i class="fas fa-search"></i> Найти
                </button>
                {% if query %}
                <a href="{% url 'chef_allergens' %}" class="btn btn-secondary">
                <i class="fas fa-times"></i> Сбросить
                </a>
                {% endif %}
            </div>
        </form>
        {% if query %}
        <div class="search-results-info">
            <i class="fas fa-info-circle"></i>
            Найдено {{ allergens|length }} аллергенов по запросу "{{ query }}"
        </div>
        {% endif %}
    </section>
    <!-- Список существующих аллергенов -->
    <section class="menu-management" style="margin-top: 20px;">
        <div class="section-header">
            <h3><i class="fas fa-list"></i> Все аллергены</h3>
            <div class="allergens-count">
                Всего: {{ allergens|length }}
            </div>
        </div>
        {% if allergens %}
        <div class="allergens-scrollable-list">
            {% for a in allergens %}
            <div class="allergen-item">
                <div class="allergen-info">
                    <span class="allergen-name">
                    {% if query and query|lower in a.name|lower %}
                    {{ a.name|safe }}
                    {% else %}
                    {{ a.name }}
                    {% endif %}
                    </span>
                    <span class="allergen-id">ID: {{ a.id }}</span>
                </div>
                <form method="post"
                    onsubmit="return confirm('Удалить аллерген «{{ a.name }}»?');"
                    class="allergen-form">
                    {% csrf_token %}
                    <input type="hidden" name="delete" value="1">
                    <input type="hidden" name="allergen_id" value="{{ a.id }}">
                    <button type="submit" class="btn-delete" style="color: #ffffff">
                    <i class="fas fa-trash whi"></i> Удалить
                    </button>
                </form>
            </div>
            {% endfor %}
        </div>
        {% if not query %}
        <div class="list-info">
            <i class="fas fa-info-circle"></i>
            Всего {{ allergens|length }} аллергенов
        </div>
        {% endif %}
        {% else %}
        <div class="no-allergens">
            <i class="fas fa-info-circle"></i>
            <p>
                {% if query %}
                По запросу "{{ query }}" ничего не найдено.
                {% else %}
                Нет зарегистрированных аллергенов.
                {% endif %}
            </p>
            {% if query %}
            <a href="{% url 'chef_allergens' %}" class="btn btn-primary">
            <i class="fas fa-list"></i> Показать все аллергены
            </a>
            {% endif %}
        </div>
        {% endif %}
    </section>
</div>
{% endblock %}